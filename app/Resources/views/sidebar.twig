<div class="panel panel-primary">
    <div class="panel-heading">
        Event Info
    </div>
    <div class="panel-body">
        <strong>{{ activeEventName() }}</strong>
        <br>
        User: {{ app.user.username }}
    </div>
</div>
<div class="row">
    <h4>Log Functions</h4>
</div>
<a href="{{ path('new_entry') }}" class="btn btn-primary btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row" data-toggle="tooltip" data-placement="right" title="ctrl-e">
        <div class="col-md-12 col-xs-12">
            <strong>Log Entry</strong>
        </div>
    </div>
</a>
<a href="{{ path('full_log') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        <div class="col-md-12 col-xs-12">
            Full Log View <span class="badge" id="logTotal-Total">{{ activeTotalLogs() }}</span>
        </div>
    </div>
</a>
<a href="{{ path('sort_filter_log', {'sort': "desc", 'filter': "open"}) }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        <div class="col-md-12 col-xs-12">
            Latest Open <span class="badge" id="logTotal-Open">{{ activeOpenLogs() }}</span>
        </div>
    </div>
</a>
<a href="{{ path('sort_filter_type_log', {'sort': "desc", 'filter': "all", 'filter_type': "medical"}) }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        <div class="col-md-12 col-xs-12">
            Latest Medical <span class="badge" id="logTotal-Medical">{{ activeMedicalLogs() }}</span>
        </div>
    </div>
</a>
<a href="{{ path('sort_filter_type_log', {'sort': "desc", 'filter': "all", 'filter_type': "security"}) }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        <div class="col-md-12 col-xs-12">
            Latest Security <span class="badge" id="logTotal-Security">{{ activeSecurityLogs() }}</span>
        </div>
    </div>
</a>
<a href="{{ path('sort_filter_type_log', {'sort': "desc", 'filter': "all", 'filter_type': "lost"}) }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        <div class="col-md-12 col-xs-12">
            Latest Lost Property <span class="badge" id="logTotal-Lost">{{ activeLostPropertyLogs() }}</span>
        </div>
    </div>
</a>
<br>
<div class="panel panel-info">
    <div class="panel-heading">
        Current Occupancy
    </div>
    <ul class="list-group">
        {% for venue in venues %}
            <li class="list-group-item" id="venue-{{ venue.id }}">{{ venue.name }}: 0</li>
        {% endfor %}
    </ul>
</div>
<div class="panel panel-warning">
    <div class="panel-heading">
        UPS Status
    </div>
    <ul class="list-group">
        {% for ups in UPSs %}
            <li class="list-group-item" id="ups-{{ ups.id }}">UPS{{ ups.id }}: Timeout</li>
        {% endfor %}
    </ul>
</div>
<div class="row">
        <h4>Operator Functions</h4>
</div>
<a href="{{ path('user_registration') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        New Operator
    </div>
</a>
<a href="{{ path('user_update') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Update User Details
    </div>
</a>
<a href="{{ path('logout') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Logout
    </div>
</a>
<a href="{{ path('signin') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Register Sign-in
    </div>
</a>
<a href="{{ path('fire_register') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Register List
    </div>
</a>
    <a href="{{ path('event_list') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Event System
    </div>
</a>
<a href="{{ path('peoplecounting') }}" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
    People Counting
    </div>
</a>
<div class="row">
        <h4>Files & Information</h4>
</div>
<a href="{{ path('media', {'filename': "ECCoP", 'type': "pdf"}) }}"  target="_blank" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Code of Practice
    </div>
</a>
<div class="row">
        <h4>Control Room Functions</h4>
</div>
<div id="LEDBtn1" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Full Working Light
    </div>
</div>
<div id="LEDBtn2" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Control Mode Working Light
    </div>
</div>
<div id="LEDBtn3" class="btn btn-default btn-block" style="margin-bottom:4px;white-space: normal;" role="button">
    <div class="row">
        Lighting Off
    </div>
</div>
<br>
<script type="text/javascript">
    $(document).ready(function() {
        sidebarPoll();
    });
    
    $('#LEDBtn1').click(function(){
        $.post( "{{ path('LED_mode', {'mode': "Working"}) }}" );
        });
        
    $('#LEDBtn2').click(function(){
        $.post( "{{ path('LED_mode', {'mode': "Control"}) }}" );
        });
        
    $('#LEDBtn3').click(function(){
        $.post( "{{ path('LED_mode', {'mode': "Off"}) }}" );
        });
    
    
    var i = 0;
    var lastStatus = ["","","",""];
    
    function sidebarPoll(){
        $.getJSON('{{ path('UPS_status') }}', function(data) {
            $.each(data, function(index, ups) {
                if (ups.loadPercentage !== null && ups.status == "Mains")
                {
                    var statusString = "UPS" + ups.id + ": "+ ups.status+"<br>(Load: "+ups.loadPercentage + "%)";
                }
                else if (ups.timeLeft !== null && ups.status == "Battery")
                {
                    var statusString = "UPS" + ups.id + ": "+ ups.status+"<br>(Battery Time: "+ups.timeLeft + " mins)";
                }
                else
                {
                    var statusString = "UPS" + ups.id + ": "+ ups.status;
                }
                //if ($('#ups-'+ups.id).html().split(' (')[0] !== statusString.split(' (')[0])
                if (lastStatus[ups.id] != ups.status)
                {
                    if (i > 5)
                    {
                        $('#ups'+ups.id+'ModalLabel').html("UPS " + ups.id + " " + ups.name);
                        $('#ups'+ups.id+'ModalBody').html("Status: " + ups.status + "<br>Location: " + ups.location);
                        $('#ups'+ups.id+'Modal').modal('show');
                    }
                    //$('#ups-'+ups.id).html(statusString);
                }
                
                if ($('#ups-'+ups.id).html() != statusString)
                {
                    $('#ups-'+ups.id).html(statusString);
                }
                
                lastStatus[ups.id] = ups.status;
                
            });
        });


        $.getJSON('{{ path('venue_json_data') }}', function(data) {
            $.each(data, function(index, venue) {
                //Calculate current occupancy
                var count = venue['count'].running_count_in - venue['count'].running_count_out;
                $('#venue-'+venue.id).html(venue.name + ": "+ count);
                if(venue.status == "false"){
                    console.log("old!")
                   $('#venue-'+venue.id).addClass("flash");
                }else{
                   $('#venue-'+venue.id).removeClass("flash");
               }
            });
        });

        $.getJSON('{{ path('log_json_data') }}', function(data) {
            $('#logTotal-Total').html(data['Total']);
            $('#logTotal-Open').html(data['Open']);
            $('#logTotal-Medical').html(data['Medical']);
            $('#logTotal-Security').html(data['Security']);
            $('#logTotal-Lost').html(data['Lost']);
        });
        
        i++;
        setTimeout(sidebarPoll,1000);
    }
</script>
